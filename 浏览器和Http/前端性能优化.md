
### 前端性能优化

#### 缓存

* 浏览器缓存

缓存方式包括 cookie、localStorage、sessionStorage、indexedDB。

* HTTP 缓存（强缓存与协商缓存）

http缓存请求的数据，HTTP 缓存大致可以分为强缓存与协商缓存

* 应用程序缓存（PWA）

PWA（Progressive Web App，渐进式网页应用，逐渐接近原生app的web app）是一种理念，使用多种技术来增强web app的功能，可以让网站的体验变得更好，能够模拟一些原生功能，比如通知推送。在移动端利用标准化框架，让网页应用呈现和原生应用相似的体验。在缓存、通知、后台功能等方面表现更好

#### 发送请求

* 避免多余重定向

每次重定向都是有请求耗时的，建议避免过多的重定向

* DNS 预解析

DNS Prefetch[2] 就是浏览器提供给我们的一个 API，用于DNS 预解析，当用户访问时就省去了DNS解析的时间

```html
<link rel="dns-prefetch" href="//yourwebsite.com">
```
* 预先建立连接(preconnect)

建立连接不仅需要 DNS 查询，还需要进行 TCP 协议握手.使用 Preconnect[3] 可以帮助你告诉浏览器：“我有一些资源会用到某个源（origin），你可以帮我预先建立连接。”

```html
<link rel="preconnect" href="//sample.com">
```
* 使用 CDN

对于一些资源我们可以使用 CDN 的资源，DNS 解析会将 CDN 资源的域名解析到 CDN 服务的负载均衡器上，负载均衡器可以通过请求的信息获取用户对应的地理区域，会综合选择一台地理位置近、负载低的机器来提供服务

#### 服务端响应

* 使用流进行响应

现代浏览器都支持根据流的返回形式来逐步进行页面内容的解析、处理。这就意味着，即使请求的响应没有完全结束，浏览器也可以从手里已有的响应结果中进行页面的解析与渲染。

* 业务聚合

**页面解析与处理**

* 把资源放在页面文档中正确的位置

JavaScript 会阻塞 DOM 构建，而 CSSOM 的构建又回阻塞 JavaScript 的执行。在优化的最佳实践中，我们基本都推荐把 CSS 样式表放在 <head> 之中（即页面的头部），把 JavaScript 脚本放在 <body> 的最后（即页面的尾部）。

* 使用 defer 和 async，防止 JavaScript 脚本的下载阻塞 DOM 构建。
    * defer：defer 会在 HTML 解析完成后，按照脚本出现的次序再顺序执行
    * async：async 则是下载完成就立即开始执行，同时阻塞页面解析，不保证脚本间的执行顺序。

*  页面文档压缩

HTML 的文档大小也会极大影响响应体下载的时间。一般会进行 HTML 内容压缩（uglify）的同时，使用文本压缩算法（例如 gzip）进行文本的压缩

**页面静态资源**

* 减少不必要的请求

浏览器对同源请求有并发上限的限制（例如 Chrome 是6），请求过多可能会导致请求被排队了，就会好时

* 减少包体大小（压缩/Tree Shaking）

包体大小对性能也是有直接影响的。显然同样速率下，包体越小，传输耗时越低，整体页面加载与渲染的性能也会更好。

* 利用缓存（浏览器缓存）

**运行时**

* 批量化你的操作

读写操作批量分别批量进行，批量读，批量写，操作批量化存储下来，等到下一次 requestAnimationFrame 触发时一起执行。I/O操作

* 长列表优化

只渲染可见区域附近的列表元素。有视口内和临近视口的上下区域内的元素会被渲染。加快渲染，减少耗时。提升性能

* 避免 JavaScript 运行时间过长（把大的js任务分解成小的任务/异步执行任务，并行计算）

由于渲染线程和 JavaScript 线程之间互斥，所以 JavaScript 执行占用时间过长会导致无法及时渲染，即出现所谓的“掉帧

* 滚动事件的性能优化（防抖/节流）

频繁地执行监听回调就容易造成 JavaScript 执行与页面渲染之间互相阻塞的情况。

**预加载**

* Prefetch （用 Prefetch 来指定在紧接着之后的操作或浏览中需要使用到的资源，让浏览器提前获取。由于仅仅是提前获取资源，因此浏览器不会对资源进行预处理）
```html
<link rel="prefetch" href="/prefetch.js" as="script">
```

* Prerender（如果你指定 Prerender 一个页面，那么它依赖的其他资源，像 <script>、<link> 等页面所需资源也可能会被下载与处理。但是预处理会基于当前机器、网络情况的不同而被不同程度地推迟）
```html
<link rel="prerender" href="//sample.com/nextpage.html">
```

* Preload（到需要 Preload 的资源时，浏览器会 立刻 进行预获取，并将结果放在内存中，资源的获取不会影响页面 parse 与 load 事件的触发。直到再次遇到该资源的使用标签时，才会执行。与 Prefetch 相比，Preload 会强制浏览器立即获取资源，并且该请求具有较高的优先级）

