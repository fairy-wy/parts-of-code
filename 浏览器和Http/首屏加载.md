### 首屏加载

首屏加载时间是指浏览器从相应用户输入网址到首屏内容渲染完成的时间，从用户的角度来说就是：“地址栏输入网址之后网页呈现的速度”。整个网站并不需要全部加载完成，但需要展示当前可视窗口中的内容。

**首屏加载过程**

发生这些过程的所有消耗的时间的总和，就是首屏加载时间。大概过程如下：

1. 浏览器的地址栏输入URL并按下回车。
2. 浏览器查找当前URL是否存在缓存，并比较缓存是否过期。
3. DNS解析URL对应的IP。
4. 根据IP建立TCP连接（三次握手）。
5. HTTP发起请求。
6. 服务器处理请求，浏览器接收HTTP响应。
7. 渲染页面，构建DOM树。
8. 关闭TCP连接（四次挥手）。

**首屏加载速度慢的原因**

* 网络延时问题
* 请求资源过多
* 资源文件体积是否过大问题
* 资源是否重复发送请求去加载问题
* 加载脚本的时候，渲染内容堵塞问题

**常见的SPA首屏优化方式**

* 减小入口文件体积

    1. 路由懒加载：以import函数的形式加载路由，这样就可以把各自的路由文件分别打包，只有在解析给定的路由时，才会加载路由组件
    2. 减小文件大小：利用uglify+tree-shaking删除无用代码

* 静态资源本地缓存

    1. 前端合理利用localStorage
    2. 采用HTTP缓存，设置Cache-Control，Last-Modified，Etag等响应头(强缓存和弱缓存)

* UI框架按需加载

    1. 在日常使用UI框架，例如element-UI，我们按需引用。只引入需要的组件，以达到减小项目体积的目的

* 避免组件重复打包

    1. 使用optimization.splitChunks和optimization.runtimeChunk分割代码块

* 图片懒加载

    * 原理：图片只在准备下滑到其区域时，才发送请求加载图片。初始化时，图片标签的src不能是真实的图片地址，也不可以是空地址或者坏地址(会出现图片加载失败的图标)。初始化的时候，可以设置图片的src是某一个小型图片。例如一张1px*1px的透明图片。由于所有图片都使用这一张图片，只会发送一次请求，不会增加性能负担。将图片的真实路径绑定给一个自定义属性，例如data-url。注意：页面的img元素，如果没有src属性，浏览器就不会发出请求去下载图片。定义滚动事件，判断元素进入视口，则将src替换为真正的url地址。利用js提取data-url的真实图片地址赋值给src属性。

* 图片资源的压缩

    1. 使用icon等在线字体和雪碧图
    2. 配置webpack中的url-loader中设置的limit大小来对图片进行处理，小于limit的图片转化成base64格式，其余的不做操作。
    3. 对于比较大的图片我们可以用image-webpack-loader 来压缩图片

* 开启GZip压缩

* 使用SSR服务端渲染，

    * 也就是服务端渲染，组件或页面通过服务器生成html字符串，再发送到浏览器。SSR技术会实现将指定的异步数据在服务端渲染好，再返回给客户端，这样就减轻了客户端的请求异步数据的压力，渲染页面就更快了。
    * vue可使用Nuxt.js框架实现服务端渲染
    * react多采用koa2等技术的实现方案。


